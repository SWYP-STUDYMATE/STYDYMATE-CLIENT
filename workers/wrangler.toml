name = "studymate-api"
main = "src/index.ts"
compatibility_date = "2025-01-08"
compatibility_flags = ["nodejs_compat"]

# Account ID
account_id = "69abd904cab5ffd103e569e7e050a884"

# Workers AI 바인딩
[ai]
binding = "AI"

# Durable Objects 바인딩 (WebRTC 룸 관리)
[[durable_objects.bindings]]
name = "ROOM"
class_name = "WebRTCRoom"

[[migrations]]
tag = "v1"
new_classes = ["WebRTCRoom"]

[[durable_objects.bindings]]
name = "USER_PRESENCE"
class_name = "UserPresence"

[[migrations]]
tag = "v2"
new_classes = ["UserPresence"]

[[durable_objects.bindings]]
name = "CHAT_HUB"
class_name = "ChatHub"

[[migrations]]
tag = "v3"
new_classes = ["ChatHub"]

# R2 Storage 바인딩 (파일 저장) - Development
[[r2_buckets]]
binding = "STORAGE"
bucket_name = "studymate-storage-dev"

# KV Namespace 바인딩 (캐싱) - Development
[[kv_namespaces]]
binding = "CACHE"
id = "997f23f600f34a3eb5b402919078933e"

# D1 Database (development)
[[d1_databases]]
binding = "DB"
database_name = "studymate-dev"
database_id = "local-studymate-dev"

# Development Environment Variables
[vars]
ENVIRONMENT = "development"
CORS_ORIGIN = "https://languagemate.kr,http://localhost:3000"
LOG_LEVEL = "debug"
API_VERSION = "v1"
API_BASE_URL = "https://api.languagemate.kr"
FRONTEND_URL = "https://languagemate.kr"

# OAuth - Naver (실제 프로덕션 값 사용)
NAVER_CLIENT_ID = "EzXpYAkIVhX1ViFQ5edo"
NAVER_CLIENT_SECRET = "Zml5tphcOJ"
NAVER_REDIRECT_URI = "https://api.languagemate.kr/login/oauth2/code/naver"

# OAuth - Google (실제 프로덕션 값 사용)
GOOGLE_CLIENT_ID = "1068056726433-kf4s0t3jj6iis0aep2kvtgfcebfmfquj.apps.googleusercontent.com"
GOOGLE_CLIENT_SECRET = "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"
GOOGLE_REDIRECT_URI = "https://api.languagemate.kr/login/oauth2/code/google"

# JWT Configuration
JWT_ISSUER = "https://api.languagemate.kr"
ACCESS_TOKEN_TTL_SECONDS = "86400"
REFRESH_TOKEN_TTL_SECONDS = "604800"

# Secrets (개발 환경용)
JWT_SECRET = "c3R1ZHltYXRlc3R1ZHltYXRlc3R1ZHltYXRlc3R1ZHltYXRlc3R1ZHltYXRlc3R1ZHltYXRlc3R1ZHltYXRlc3R1ZHltYXRlc3R1ZHltYXRlc3R1ZHltYXRlc3R1ZHltYXRlc3R1ZHltYXRlc3R1ZHltYXRl"
INTERNAL_SECRET = "studymate-internal-secret-2024"
WORKERS_INTERNAL_SECRET = "studymate-internal-secret-2024"

# Cloudflare TURN API 크레덴셜 (동적 자격 증명 생성용)
# Dashboard → Calls → TURN에서 발급
# ⚠️ 주의: 이 값은 민감 정보이므로 GitHub에 커밋 시 주의 필요
# 프로덕션 배포 시 wrangler secret put 사용 권장
CLOUDFLARE_TURN_TOKEN_ID = "afb3aec97894ed29c88a0975653409d2"
CLOUDFLARE_TURN_API_TOKEN = "c8efd3dfc592f4cac643f190896b57ae775ed6e342a33b78310784ba5b57bc25"

# Production 환경
[env.production]
name = "studymate-api-production"

# Production Workers AI 바인딩
[env.production.ai]
binding = "AI"

# Production Durable Objects 바인딩
[[env.production.durable_objects.bindings]]
name = "ROOM"
class_name = "WebRTCRoom"

[[env.production.durable_objects.bindings]]
name = "USER_PRESENCE"
class_name = "UserPresence"

[[env.production.durable_objects.bindings]]
name = "CHAT_HUB"
class_name = "ChatHub"

# Production R2 Storage
[[env.production.r2_buckets]]
binding = "STORAGE"
bucket_name = "studymate-storage"

# Production KV Namespace
[[env.production.kv_namespaces]]
binding = "CACHE"
id = "42a956e075ea4bda84dade92a95a0756"

# Production D1 Database
[[env.production.d1_databases]]
binding = "DB"
database_name = "studymate-db"
database_id = "3f35333b-2760-40c6-b6ec-fd9d9d094aeb"

# Production Analytics Engine binding
[[env.production.analytics_engine_datasets]]
binding = "ANALYTICS"

# Production Environment Variables
[env.production.vars]
ENVIRONMENT = "production"
CORS_ORIGIN = "https://languagemate.kr,https://www.languagemate.kr"
LOG_LEVEL = "error"
API_VERSION = "v1"
API_BASE_URL = "https://api.languagemate.kr"
FRONTEND_URL = "https://languagemate.kr"

# OAuth - Naver (실제 프로덕션 값)
NAVER_CLIENT_ID = "EzXpYAkIVhX1ViFQ5edo"
NAVER_CLIENT_SECRET = "Zml5tphcOJ"
NAVER_REDIRECT_URI = "https://api.languagemate.kr/login/oauth2/code/naver"

# OAuth - Google (실제 프로덕션 값)
GOOGLE_CLIENT_ID = "1068056726433-kf4s0t3jj6iis0aep2kvtgfcebfmfquj.apps.googleusercontent.com"
GOOGLE_CLIENT_SECRET = "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"
GOOGLE_REDIRECT_URI = "https://api.languagemate.kr/login/oauth2/code/google"

# JWT Configuration
JWT_ISSUER = "https://api.languagemate.kr"
ACCESS_TOKEN_TTL_SECONDS = "86400"
REFRESH_TOKEN_TTL_SECONDS = "604800"

# Secrets (프로덕션 환경용)
JWT_SECRET = "c3R1ZHltYXRlc3R1ZHltYXRlc3R1ZHltYXRlc3R1ZHltYXRlc3R1ZHltYXRlc3R1ZHltYXRlc3R1ZHltYXRlc3R1ZHltYXRlc3R1ZHltYXRlc3R1ZHltYXRlc3R1ZHltYXRlc3R1ZHltYXRlc3R1ZHltYXRl"
INTERNAL_SECRET = "studymate-internal-secret-2024"
WORKERS_INTERNAL_SECRET = "studymate-internal-secret-2024"

# Cloudflare TURN API 크레덴셜 (프로덕션 - 동적 자격 증명 생성용)
# Dashboard → Calls → TURN에서 발급
# ⚠️ 주의: 이 값은 민감 정보이므로 GitHub에 커밋 시 주의 필요
# 보안 강화를 위해 wrangler secret put 사용 권장:
#   wrangler secret put CLOUDFLARE_TURN_TOKEN_ID --env production
#   wrangler secret put CLOUDFLARE_TURN_API_TOKEN --env production
CLOUDFLARE_TURN_TOKEN_ID = "afb3aec97894ed29c88a0975653409d2"
CLOUDFLARE_TURN_API_TOKEN = "c8efd3dfc592f4cac643f190896b57ae775ed6e342a33b78310784ba5b57bc25"

# Production Routes
[[env.production.routes]]
pattern = "api.languagemate.kr/*"
zone_name = "languagemate.kr"

[triggers]
crons = ["*/5 * * * *"]

[env.production.triggers]
crons = ["*/5 * * * *"]

# Observability (all environments)
[observability]
enabled = true

# Development server configuration
[dev]
port = 8787
local_protocol = "http"
upstream_protocol = "https"

# Limits
[limits]
cpu_ms = 50
startup_cpu_ms = 100

# Analytics Engine binding
[[analytics_engine_datasets]]
binding = "ANALYTICS"
