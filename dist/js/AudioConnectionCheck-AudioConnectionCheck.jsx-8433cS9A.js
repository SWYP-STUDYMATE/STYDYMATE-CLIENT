import{b as e,z as s}from"./vendor-chunk-3fnplnT6.js";import{C as t}from"./CommonButton-chunk-BpPP3d6j.js";import{f as c,s as n,t as a,u as r,W as i,l,m as d,L as o}from"./ui-vendor-chunk-DkBAET_w.js";import{u}from"./react-vendor-chunk-COHvxYfz.js";function x(){const x=u(),[m,h]=e.useState("idle"),[f,p]=e.useState("idle"),[j,w]=e.useState("idle"),[N,b]=e.useState(0),[g,v]=e.useState(null),[y,F]=e.useState(!1),[E,A]=e.useState(null),k=e.useRef(null),C=e.useRef([]),T=e.useRef(null),R=e.useRef(null),S=e.useRef(null),L=e.useRef(null);e.useEffect(()=>()=>{L.current&&L.current.getTracks().forEach(e=>e.stop()),S.current&&cancelAnimationFrame(S.current),T.current&&T.current.close()},[]);const M=()=>{if(!R.current)return;const e=new Uint8Array(R.current.frequencyBinCount);R.current.getByteFrequencyData(e);const s=e.reduce((e,s)=>e+s)/e.length;b(Math.min(s/128,1)),S.current=requestAnimationFrame(M)},B=async()=>{await(async()=>{h("testing");try{const e=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,sampleRate:44100}});L.current=e,T.current=new(window.AudioContext||window.webkitAudioContext),R.current=T.current.createAnalyser(),T.current.createMediaStreamSource(e).connect(R.current),R.current.fftSize=256;const s={mimeType:"audio/webm;codecs=opus"};MediaRecorder.isTypeSupported(s.mimeType)||(s.mimeType="audio/webm"),k.current=new MediaRecorder(e,s),C.current=[],k.current.ondataavailable=e=>{e.data.size>0&&C.current.push(e.data)},k.current.onstop=()=>{const e=new Blob(C.current,{type:"audio/webm"});A(e),F(!1);const s=URL.createObjectURL(e);new Audio(s).play().then(()=>{h("success")}).catch(()=>{h("failed")})},k.current.start(),F(!0),M(),setTimeout(()=>{k.current&&"recording"===k.current.state&&(k.current.stop(),e.getTracks().forEach(e=>e.stop()),S.current&&cancelAnimationFrame(S.current))},3e3)}catch(e){h("failed")}})(),setTimeout(()=>(async()=>{p("testing");try{const e=new(window.AudioContext||window.webkitAudioContext),s=e.createOscillator(),t=e.createGain();s.connect(t),t.connect(e.destination),s.frequency.value=440,t.gain.value=.3,s.start(),t.gain.exponentialRampToValueAtTime(.01,e.currentTime+.5),setTimeout(()=>{s.stop(),p("success")},500)}catch(e){p("failed")}})(),4e3),setTimeout(()=>(async()=>{w("testing");try{const e=Date.now(),s=await fetch("https://www.google.com/images/branding/googlelogo/2x/googlelogo_color_272x92dp.png",{cache:"no-cache"}),t=await s.blob(),c=(Date.now()-e)/1e3,n=t.size/1048576*8/c;v(n),w(n>=1?"success":"failed")}catch(e){w("failed")}})(),5e3)},D=e=>{switch(e){case"idle":default:return null;case"testing":return s.jsx(o,{className:"w-5 h-5 animate-spin text-[#4285F4]"});case"success":return s.jsx(d,{className:"w-5 h-5 text-[#00C471]"});case"failed":return s.jsx(l,{className:"w-5 h-5 text-[#EA4335]"})}},q="success"===m&&"success"===f&&"success"===j;return s.jsx("div",{className:"min-h-screen bg-[#FAFAFA] flex flex-col",children:s.jsxs("div",{className:"max-w-[768px] w-full mx-auto flex flex-col min-h-screen",children:[s.jsx("div",{className:"px-6 py-4 bg-white border-b border-[#E7E7E7]",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("button",{onClick:()=>x(-1),className:"p-2 -ml-2 hover:bg-gray-100 rounded-lg transition-colors",children:s.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:s.jsx("path",{d:"M15 18L9 12L15 6",stroke:"#111111",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})}),s.jsx("h1",{className:"text-[18px] font-bold text-[#111111]",children:"음성 세션 연결 확인"}),s.jsx("div",{className:"w-10"})]})}),s.jsxs("div",{className:"flex-1 px-6 py-8",children:[s.jsxs("div",{className:"text-center mb-8",children:[s.jsx("h2",{className:"text-[24px] font-bold text-[#111111] mb-2",children:"세션 시작 전 확인사항"}),s.jsx("p",{className:"text-[16px] text-[#606060]",children:"원활한 음성 통화를 위해 디바이스를 테스트합니다"})]}),s.jsxs("div",{className:"space-y-4 mb-8",children:[s.jsxs("div",{className:"bg-white rounded-[10px] p-6 border border-[#E7E7E7]",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"w-12 h-12 bg-[#E6F9F1] rounded-full flex items-center justify-center mr-4",children:y?s.jsx(c,{className:"w-6 h-6 text-[#00C471]"}):s.jsx(n,{className:"w-6 h-6 text-[#00C471]"})}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-[16px] font-medium text-[#111111]",children:"마이크 테스트"}),s.jsxs("p",{className:"text-[14px] text-[#929292]",children:["idle"===m&&"테스트를 시작하세요","testing"===m&&"3초간 말씀해주세요...","success"===m&&"정상 작동","failed"===m&&"마이크를 확인하세요"]})]})]}),D(m)]}),y&&s.jsx("div",{className:"mt-4",children:s.jsx("div",{className:"h-2 bg-[#E7E7E7] rounded-full overflow-hidden",children:s.jsx("div",{className:"h-full bg-[#00C471] transition-all duration-100",style:{width:100*N+"%"}})})})]}),s.jsx("div",{className:"bg-white rounded-[10px] p-6 border border-[#E7E7E7]",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"w-12 h-12 bg-[#E8F4FD] rounded-full flex items-center justify-center mr-4",children:s.jsx(a,{className:"w-6 h-6 text-[#4285F4]"})}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-[16px] font-medium text-[#111111]",children:"스피커 테스트"}),s.jsxs("p",{className:"text-[14px] text-[#929292]",children:["idle"===f&&"테스트를 시작하세요","testing"===f&&"테스트 음이 재생됩니다...","success"===f&&"정상 작동","failed"===f&&"스피커를 확인하세요"]})]})]}),D(f)]})}),s.jsx("div",{className:"bg-white rounded-[10px] p-6 border border-[#E7E7E7]",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"w-12 h-12 bg-[#FFF5E6] rounded-full flex items-center justify-center mr-4",children:"failed"===j?s.jsx(r,{className:"w-6 h-6 text-[#FFA500]"}):s.jsx(i,{className:"w-6 h-6 text-[#FFA500]"})}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-[16px] font-medium text-[#111111]",children:"인터넷 연결"}),s.jsxs("p",{className:"text-[14px] text-[#929292]",children:["idle"===j&&"테스트를 시작하세요","testing"===j&&"연결 속도 측정 중...","success"===j&&`연결 양호 (${g?.toFixed(1)} Mbps)`,"failed"===j&&"연결이 불안정합니다"]})]})]}),D(j)]})})]}),s.jsx("div",{className:"bg-[#F8F9FA] rounded-[10px] p-4 mb-8",children:s.jsx("p",{className:"text-[14px] text-[#606060]",children:"💡 모든 테스트를 통과해야 원활한 음성 통화가 가능합니다. 문제가 있다면 디바이스 설정을 확인해주세요."})})]}),s.jsx("div",{className:"px-6 pb-8",children:"idle"===m&&"idle"===f&&"idle"===j?s.jsx(t,{onClick:B,className:"w-full",variant:"primary",children:"전체 테스트 시작"}):q?s.jsx(t,{onClick:()=>x("/session/audio-room"),className:"w-full",variant:"success",children:"세션 시작하기"}):s.jsxs("div",{className:"space-y-3",children:[s.jsx(t,{onClick:B,className:"w-full",variant:"secondary",children:"다시 테스트"}),("testing"===m||"testing"===f||"testing"===j)&&s.jsx("p",{className:"text-center text-[14px] text-[#929292]",children:"테스트 진행 중..."})]})})]})})}export{x as default};
