import{b as e,z as s}from"./vendor-chunk-3fnplnT6.js";import{C as t}from"./CommonButton-chunk-BpPP3d6j.js";import{A as c,D as i,F as a,f as l,t as n,u as r,W as d,v as o,l as x,m as u,L as m}from"./ui-vendor-chunk-DkBAET_w.js";import{u as h}from"./react-vendor-chunk-COHvxYfz.js";function j(){const j=h(),[f,v]=e.useState("idle"),[p,g]=e.useState("idle"),[b,N]=e.useState("idle"),[w,y]=e.useState("idle"),[E,F]=e.useState(0),[k,A]=e.useState(null),[C,S]=e.useState(""),[I,T]=e.useState(""),[D,M]=e.useState([]),[R,L]=e.useState([]),[q,B]=e.useState(!1),z=e.useRef(null),U=e.useRef(null),$=e.useRef(null),O=e.useRef(null),W=e.useRef(null);e.useEffect(()=>(navigator.mediaDevices.enumerateDevices().then(e=>{const s=e.filter(e=>"videoinput"===e.kind),t=e.filter(e=>"audioinput"===e.kind);M(s),L(t),s.length>0&&S(s[0].deviceId),t.length>0&&T(t[0].deviceId)}),()=>{U.current&&U.current.getTracks().forEach(e=>e.stop()),W.current&&cancelAnimationFrame(W.current),$.current&&$.current.close()}),[]);const _=()=>{if(!O.current)return;const e=new Uint8Array(O.current.frequencyBinCount);O.current.getByteFrequencyData(e);const s=e.reduce((e,s)=>e+s)/e.length;F(Math.min(s/128,1)),W.current=requestAnimationFrame(_)},G=async()=>{await(async()=>{v("testing");try{U.current&&U.current.getTracks().forEach(e=>e.stop());const e=await navigator.mediaDevices.getUserMedia({video:{deviceId:C?{exact:C}:void 0,width:{ideal:1280},height:{ideal:720}},audio:!1});U.current=e,z.current&&(z.current.srcObject=e),v("success")}catch(e){v("failed")}})(),setTimeout(()=>(async()=>{g("testing");try{const e=await navigator.mediaDevices.getUserMedia({audio:{deviceId:I?{exact:I}:void 0,echoCancellation:!0,noiseSuppression:!0,sampleRate:44100}});$.current=new(window.AudioContext||window.webkitAudioContext),O.current=$.current.createAnalyser(),$.current.createMediaStreamSource(e).connect(O.current),O.current.fftSize=256,_(),setTimeout(()=>{e.getTracks().forEach(e=>e.stop()),W.current&&cancelAnimationFrame(W.current),F(0),g("success")},3e3)}catch(e){g("failed")}})(),1e3),setTimeout(()=>(async()=>{N("testing");try{const e=new(window.AudioContext||window.webkitAudioContext),s=e.createOscillator(),t=e.createGain();s.connect(t),t.connect(e.destination),s.frequency.value=440,t.gain.value=.3,s.start(),t.gain.exponentialRampToValueAtTime(.01,e.currentTime+.5),setTimeout(()=>{s.stop(),N("success")},500)}catch(e){N("failed")}})(),4500),setTimeout(()=>(async()=>{y("testing");try{const e=Date.now(),s=await fetch("https://www.google.com/images/branding/googlelogo/2x/googlelogo_color_272x92dp.png",{cache:"no-cache"}),t=await s.blob(),c=(Date.now()-e)/1e3,i=t.size/1048576*8/c;A(i),y(i>=2?"success":"failed")}catch(e){y("failed")}})(),5500)},P=e=>{switch(e){case"idle":default:return null;case"testing":return s.jsx(m,{className:"w-5 h-5 animate-spin text-[#4285F4]"});case"success":return s.jsx(u,{className:"w-5 h-5 text-[#00C471]"});case"failed":return s.jsx(x,{className:"w-5 h-5 text-[#EA4335]"})}},V="success"===f&&"success"===p&&"success"===b&&"success"===w;return s.jsx("div",{className:"min-h-screen bg-[#FAFAFA] flex flex-col",children:s.jsxs("div",{className:"max-w-[1024px] w-full mx-auto flex flex-col min-h-screen",children:[s.jsx("div",{className:"px-6 py-4 bg-white border-b border-[#E7E7E7]",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("button",{onClick:()=>j(-1),className:"p-2 -ml-2 hover:bg-gray-100 rounded-lg transition-colors",children:s.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:s.jsx("path",{d:"M15 18L9 12L15 6",stroke:"#111111",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})}),s.jsx("h1",{className:"text-[18px] font-bold text-[#111111]",children:"화상 세션 연결 확인"}),s.jsx("button",{onClick:()=>B(!q),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:s.jsx(c,{className:"w-5 h-5 text-[#606060]"})})]})}),q&&s.jsx("div",{className:"bg-white border-b border-[#E7E7E7] px-6 py-4",children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-[14px] text-[#606060] mb-2",children:"카메라 선택"}),s.jsx("select",{value:C,onChange:e=>S(e.target.value),className:"w-full px-4 py-2 border border-[#E7E7E7] rounded-lg focus:outline-none focus:border-[#4285F4]",children:D.map(e=>s.jsx("option",{value:e.deviceId,children:e.label||`카메라 ${e.deviceId.slice(0,5)}`},e.deviceId))})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-[14px] text-[#606060] mb-2",children:"마이크 선택"}),s.jsx("select",{value:I,onChange:e=>T(e.target.value),className:"w-full px-4 py-2 border border-[#E7E7E7] rounded-lg focus:outline-none focus:border-[#4285F4]",children:R.map(e=>s.jsx("option",{value:e.deviceId,children:e.label||`마이크 ${e.deviceId.slice(0,5)}`},e.deviceId))})]})]})}),s.jsx("div",{className:"flex-1 px-6 py-8",children:s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-[20px] font-bold text-[#111111] mb-4",children:"카메라 미리보기"}),s.jsxs("div",{className:"relative aspect-video bg-black rounded-[10px] overflow-hidden",children:[s.jsx("video",{ref:z,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover"}),"idle"===f&&s.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-[#111111]/80",children:s.jsxs("div",{className:"text-center",children:[s.jsx(i,{className:"w-12 h-12 text-white mb-2 mx-auto"}),s.jsx("p",{className:"text-white",children:"카메라를 시작하려면 테스트를 실행하세요"})]})}),"failed"===f&&s.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-[#EA4335]/90",children:s.jsxs("div",{className:"text-center",children:[s.jsx(i,{className:"w-12 h-12 text-white mb-2 mx-auto"}),s.jsx("p",{className:"text-white",children:"카메라를 사용할 수 없습니다"})]})})]})]}),s.jsxs("div",{children:[s.jsx("h2",{className:"text-[20px] font-bold text-[#111111] mb-4",children:"연결 테스트"}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("div",{className:"bg-white rounded-[10px] p-4 border border-[#E7E7E7]",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"w-10 h-10 bg-[#FFE6E6] rounded-full flex items-center justify-center mr-3",children:s.jsx(a,{className:"w-5 h-5 text-[#EA4335]"})}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-[14px] font-medium text-[#111111]",children:"카메라"}),s.jsxs("p",{className:"text-[12px] text-[#929292]",children:["idle"===f&&"대기 중","testing"===f&&"테스트 중...","success"===f&&"정상 작동","failed"===f&&"사용 불가"]})]})]}),P(f)]})}),s.jsxs("div",{className:"bg-white rounded-[10px] p-4 border border-[#E7E7E7]",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"w-10 h-10 bg-[#E6F9F1] rounded-full flex items-center justify-center mr-3",children:s.jsx(l,{className:"w-5 h-5 text-[#00C471]"})}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-[14px] font-medium text-[#111111]",children:"마이크"}),s.jsxs("p",{className:"text-[12px] text-[#929292]",children:["idle"===p&&"대기 중","testing"===p&&"3초간 말씀해주세요...","success"===p&&"정상 작동","failed"===p&&"사용 불가"]})]})]}),P(p)]}),"testing"===p&&s.jsx("div",{className:"mt-3",children:s.jsx("div",{className:"h-2 bg-[#E7E7E7] rounded-full overflow-hidden",children:s.jsx("div",{className:"h-full bg-[#00C471] transition-all duration-100",style:{width:100*E+"%"}})})})]}),s.jsx("div",{className:"bg-white rounded-[10px] p-4 border border-[#E7E7E7]",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"w-10 h-10 bg-[#E8F4FD] rounded-full flex items-center justify-center mr-3",children:s.jsx(n,{className:"w-5 h-5 text-[#4285F4]"})}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-[14px] font-medium text-[#111111]",children:"스피커"}),s.jsxs("p",{className:"text-[12px] text-[#929292]",children:["idle"===b&&"대기 중","testing"===b&&"테스트 음 재생 중...","success"===b&&"정상 작동","failed"===b&&"사용 불가"]})]})]}),P(b)]})}),s.jsx("div",{className:"bg-white rounded-[10px] p-4 border border-[#E7E7E7]",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:"w-10 h-10 bg-[#FFF5E6] rounded-full flex items-center justify-center mr-3",children:"failed"===w?s.jsx(r,{className:"w-5 h-5 text-[#FFA500]"}):s.jsx(d,{className:"w-5 h-5 text-[#FFA500]"})}),s.jsxs("div",{children:[s.jsx("h3",{className:"text-[14px] font-medium text-[#111111]",children:"인터넷"}),s.jsxs("p",{className:"text-[12px] text-[#929292]",children:["idle"===w&&"대기 중","testing"===w&&"속도 측정 중...","success"===w&&`${k?.toFixed(1)} Mbps`,"failed"===w&&"속도 부족"]})]})]}),P(w)]})})]}),s.jsx("div",{className:"mt-6 p-4 bg-[#F8F9FA] rounded-[10px]",children:s.jsx("p",{className:"text-[13px] text-[#606060]",children:"💡 화상 통화를 위해서는 최소 2Mbps 이상의 인터넷 속도가 필요합니다. 모든 테스트를 통과해야 원활한 화상 통화가 가능합니다."})})]})]})}),s.jsx("div",{className:"px-6 pb-8",children:s.jsx("div",{className:"max-w-md mx-auto",children:"idle"===f&&"idle"===p&&"idle"===b&&"idle"===w?s.jsxs(t,{onClick:G,className:"w-full",variant:"primary",children:[s.jsx(o,{className:"w-5 h-5 mr-2"}),"전체 테스트 시작"]}):V?s.jsx(t,{onClick:()=>j("/session/video-room"),className:"w-full",variant:"success",children:"화상 세션 시작하기"}):s.jsxs("div",{className:"space-y-3",children:[s.jsx(t,{onClick:G,className:"w-full",variant:"secondary",children:"다시 테스트"}),("testing"===f||"testing"===p||"testing"===b||"testing"===w)&&s.jsx("p",{className:"text-center text-[14px] text-[#929292]",children:"테스트 진행 중... 잠시만 기다려주세요"})]})})})]})})}export{j as default};
