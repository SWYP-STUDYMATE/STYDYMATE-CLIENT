import{b as e,z as s,L as t,F as a}from"./vendor-chunk-D6LsFSV7.js";import{R as l,o as r,v as n,n as i,U as c,G as d,A as o}from"./ui-vendor-chunk-CYPVLLJ1.js";import"./react-vendor-chunk-CMkIwBz9.js";const x="https://api.languagemate.kr";function h(){const[h,u]=e.useState(null),[p,j]=e.useState(!0),[b,v]=e.useState(null),[N,f]=e.useState("24h"),[y,w]=e.useState(!0),R=e.useRef(null),A=e.useRef(null),S=async()=>{try{const e=await fetch(`${x}/api/v1/analytics/dashboard`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!e.ok)throw new Error("Failed to fetch analytics data");const s=await e.json();u(s.data),v(null)}catch(e){v(e.message)}finally{j(!1)}},$=()=>{if(R.current?.readyState===WebSocket.OPEN)return;const e=new WebSocket(`${x.replace("http","ws")}/api/v1/analytics/stream`);e.onopen=()=>{},e.onmessage=e=>{try{const s=JSON.parse(e.data);"metrics_update"===s.type&&k(s.data)}catch(s){}},e.onerror=e=>{},e.onclose=()=>{y&&setTimeout($,5e3)},R.current=e},k=e=>{u(s=>({...s,realtime:e}))};if(e.useEffect(()=>(S(),y&&(A.current=setInterval(S,3e4),$()),()=>{A.current&&clearInterval(A.current),R.current&&R.current.close()}),[y]),p)return s.jsx("div",{className:"flex items-center justify-center h-96",children:s.jsx(l,{className:"w-8 h-8 animate-spin text-blue-500"})});if(b)return s.jsxs("div",{className:"bg-red-50 p-4 rounded-lg flex items-center gap-2",children:[s.jsx(r,{className:"w-5 h-5 text-red-500"}),s.jsx("span",{className:"text-red-700",children:b})]});const{overview:C,topPaths:L,errorsByStatus:P,geoDistribution:D,realtime:F}=h||{},T={labels:L?.slice(0,5).map(e=>e.path)||[],datasets:[{label:"Requests",data:L?.slice(0,5).map(e=>e.count)||[],backgroundColor:"rgba(59, 130, 246, 0.8)"}]};return s.jsxs("div",{className:"p-6 space-y-6",children:[s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Analytics Dashboard"}),s.jsx("p",{className:"text-gray-600",children:"Monitor your API performance and usage"})]}),s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsxs("select",{value:N,onChange:e=>f(e.target.value),className:"px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[s.jsx("option",{value:"1h",children:"Last hour"}),s.jsx("option",{value:"24h",children:"Last 24 hours"}),s.jsx("option",{value:"7d",children:"Last 7 days"}),s.jsx("option",{value:"30d",children:"Last 30 days"})]}),s.jsxs("button",{onClick:()=>w(!y),className:"px-4 py-2 rounded-lg flex items-center gap-2 "+(y?"bg-green-100 text-green-700":"bg-gray-100 text-gray-700"),children:[s.jsx(l,{className:"w-4 h-4 "+(y?"animate-spin":"")}),y?"Auto":"Manual"]})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[s.jsx(m,{title:"Total Requests",value:C?.last24h?.count||0,change:"+12.5%",icon:s.jsx(n,{className:"w-5 h-5"}),color:"blue"}),s.jsx(m,{title:"Avg Response Time",value:`${C?.last24h?.avgDuration?.toFixed(0)||0}ms`,change:"-8.3%",icon:s.jsx(i,{className:"w-5 h-5"}),color:"green"}),s.jsx(m,{title:"Error Rate",value:`${(100*C?.last24h?.errorRate)?.toFixed(1)||0}%`,change:"+0.2%",icon:s.jsx(r,{className:"w-5 h-5"}),color:"red"}),s.jsx(m,{title:"Active Users",value:F?.activeUsers||0,change:"Live",icon:s.jsx(c,{className:"w-5 h-5"}),color:"purple"})]}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[s.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[s.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Request Trend"}),s.jsx(t,{data:{labels:["24h ago","18h ago","12h ago","6h ago","Now"],datasets:[{label:"Requests",data:[120,145,165,180,195],borderColor:"rgb(59, 130, 246)",backgroundColor:"rgba(59, 130, 246, 0.1)",tension:.4,fill:!0}]},options:{responsive:!0,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0}}}})]}),s.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[s.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Top Endpoints"}),s.jsx(a,{data:T,options:{responsive:!0,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0}}}})]}),s.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[s.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Response Status"}),s.jsx("div",{className:"h-64 flex items-center justify-center",children:s.jsx(Doughnut,{data:{labels:["2xx","3xx","4xx","5xx"],datasets:[{data:[75,10,12,3],backgroundColor:["rgba(34, 197, 94, 0.8)","rgba(59, 130, 246, 0.8)","rgba(251, 146, 60, 0.8)","rgba(239, 68, 68, 0.8)"]}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"right"}}}})})]}),s.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[s.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Performance Metrics"}),s.jsxs("div",{className:"space-y-4",children:[s.jsx(g,{label:"P50 Latency",value:`${C?.last24h?.p50Duration?.toFixed(0)||0}ms`,max:1e3}),s.jsx(g,{label:"P95 Latency",value:`${C?.last24h?.p95Duration?.toFixed(0)||0}ms`,max:1e3}),s.jsx(g,{label:"P99 Latency",value:`${C?.last24h?.p99Duration?.toFixed(0)||0}ms`,max:1e3}),s.jsx(g,{label:"CPU Time",value:`${C?.last24h?.avgCpuTime?.toFixed(0)||0}ms`,max:500})]})]})]}),s.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[s.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[s.jsx(d,{className:"w-5 h-5"}),"Geographic Distribution"]}),s.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:D?.slice(0,8).map((e,t)=>s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-2xl font-bold text-blue-600",children:e.count}),s.jsx("div",{className:"text-sm text-gray-600",children:e.country})]},t))})]}),F&&s.jsxs("div",{className:"bg-gray-900 text-white p-6 rounded-lg",children:[s.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[s.jsx(o,{className:"w-5 h-5 text-green-400"}),"Real-time Activity"]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[s.jsxs("div",{children:[s.jsx("div",{className:"text-3xl font-bold text-green-400",children:F.requestsPerSecond||0}),s.jsx("div",{className:"text-sm text-gray-400",children:"Requests/sec"})]}),s.jsxs("div",{children:[s.jsxs("div",{className:"text-3xl font-bold text-blue-400",children:[F.avgResponseTime||0,"ms"]}),s.jsx("div",{className:"text-sm text-gray-400",children:"Avg Response"})]}),s.jsxs("div",{children:[s.jsx("div",{className:"text-3xl font-bold text-yellow-400",children:F.activeConnections||0}),s.jsx("div",{className:"text-sm text-gray-400",children:"Active Connections"})]})]})]})]})}function m({title:e,value:t,change:a,icon:l,color:r}){const n=a.startsWith("+")?"text-green-600":a.startsWith("-")?"text-red-600":"text-gray-600";return s.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("h3",{className:"text-sm font-medium text-gray-600",children:e}),s.jsx("div",{className:`p-2 rounded-lg ${{blue:"bg-blue-50 text-blue-600",green:"bg-green-50 text-green-600",red:"bg-red-50 text-red-600",purple:"bg-purple-50 text-purple-600"}[r]}`,children:l})]}),s.jsx("div",{className:"text-2xl font-bold text-gray-900",children:t}),s.jsx("div",{className:`text-sm ${n} mt-1`,children:a})]})}function g({label:e,value:t,max:a}){const l=parseInt(t),r=Math.min(l/a*100,100),n=r<50?"bg-green-500":r<80?"bg-yellow-500":"bg-red-500";return s.jsxs("div",{children:[s.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[s.jsx("span",{className:"text-gray-600",children:e}),s.jsx("span",{className:"font-medium",children:t})]}),s.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:s.jsx("div",{className:`${n} h-2 rounded-full transition-all duration-300`,style:{width:`${r}%`}})})]})}export{h as default};
