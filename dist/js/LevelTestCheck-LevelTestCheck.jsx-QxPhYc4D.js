import{b as e,z as t}from"./vendor-chunk-D6LsFSV7.js";import{C as s}from"./CommonButton-chunk-BGn4hO1n.js";import{u as n}from"./levelTestStore-chunk-B4uhrPXk.js";import{f as c,W as r,l as a,m as i,L as d}from"./ui-vendor-chunk-CYPVLLJ1.js";import{u as l}from"./react-vendor-chunk-CMkIwBz9.js";import"./utils-vendor-chunk-Clitctyl.js";function o(){const o=l(),[x,m]=e.useState("checking"),[h,u]=e.useState("checking"),[j,f]=e.useState(!0),[p,g]=e.useState(0),[N,v]=e.useState(null),{setConnectionStatus:b,setTestStatus:w,setAudioLevel:k}=n();e.useEffect(()=>(E(),()=>{N&&N.getTracks().forEach(e=>e.stop())}),[]);const E=async()=>{try{const e=await navigator.mediaDevices.getUserMedia({audio:!0});v(e),m("granted"),b({microphone:!0}),y(e)}catch(e){m("denied"),b({microphone:!1})}navigator.onLine?(u("connected"),b({internet:!0})):(u("disconnected"),b({internet:!1})),setTimeout(()=>{f(!1)},1500)},y=e=>{const t=new(window.AudioContext||window.webkitAudioContext),s=t.createAnalyser(),n=t.createMediaStreamSource(e),c=t.createScriptProcessor(2048,1,1);s.smoothingTimeConstant=.8,s.fftSize=1024,n.connect(s),s.connect(c),c.connect(t.destination),c.onaudioprocess=()=>{const e=new Uint8Array(s.frequencyBinCount);s.getByteFrequencyData(e);const t=e.reduce((e,t)=>e+t,0)/e.length,n=Math.min(100,Math.round(t));g(n),k(n)}},C=e=>{switch(e){case"checking":return t.jsx(d,{className:"w-5 h-5 text-[#929292] animate-spin"});case"granted":case"connected":return t.jsx(i,{className:"w-5 h-5 text-[#00C471]"});case"denied":case"disconnected":return t.jsx(a,{className:"w-5 h-5 text-[#EA4335]"});default:return null}},F=(e,t)=>{if("mic"===e)switch(t){case"checking":return"확인 중...";case"granted":return"마이크 사용 가능";case"denied":return"마이크 권한이 필요합니다";default:return""}else switch(t){case"checking":return"확인 중...";case"connected":return"인터넷 연결됨";case"disconnected":return"인터넷 연결을 확인해주세요";default:return""}},S="granted"===x&&"connected"===h;return t.jsxs("div",{className:"min-h-screen bg-[#FAFAFA] flex flex-col",children:[t.jsx("div",{className:"bg-white border-b border-[#E7E7E7] px-6 py-4",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx("button",{onClick:()=>o(-1),className:"p-2 -ml-2",children:t.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:t.jsx("path",{d:"M15 18L9 12L15 6",stroke:"#111111",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})}),t.jsx("h1",{className:"text-[18px] font-bold text-[#111111] flex-1 text-center mr-6",children:"연결 확인"})]})}),t.jsx("div",{className:"flex-1 flex flex-col items-center justify-center px-6 py-8",children:t.jsxs("div",{className:"w-full max-w-[400px]",children:[t.jsx("h2",{className:"text-[24px] font-bold text-[#111111] mb-3 text-center",children:"테스트 환경을 확인하고 있어요"}),t.jsx("p",{className:"text-[16px] text-[#929292] mb-8 text-center",children:"원활한 테스트를 위해 필요한 권한을 확인합니다"}),t.jsxs("div",{className:"space-y-4 mb-8",children:[t.jsx("div",{className:"bg-white rounded-[10px] p-4 border border-[#E7E7E7]",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"w-10 h-10 bg-[#E6F9F1] rounded-full flex items-center justify-center",children:t.jsx(c,{className:"w-5 h-5 text-[#00C471]"})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("p",{className:"text-[14px] font-medium text-[#111111]",children:"마이크"}),t.jsx("p",{className:"text-[12px] text-[#929292]",children:F("mic",x)}),"granted"===x&&t.jsxs("div",{className:"mt-2",children:[t.jsx("div",{className:"w-full bg-[#F1F3F5] rounded-full h-2",children:t.jsx("div",{className:"bg-[#00C471] h-2 rounded-full transition-all duration-200",style:{width:`${p}%`}})}),t.jsxs("p",{className:"text-[10px] text-[#929292] mt-1",children:["오디오 레벨: ",p,"%"]})]})]})]}),C(x)]})}),t.jsx("div",{className:"bg-white rounded-[10px] p-4 border border-[#E7E7E7]",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"w-10 h-10 bg-[#E6F9F1] rounded-full flex items-center justify-center",children:t.jsx(r,{className:"w-5 h-5 text-[#00C471]"})}),t.jsxs("div",{children:[t.jsx("p",{className:"text-[14px] font-medium text-[#111111]",children:"인터넷"}),t.jsx("p",{className:"text-[12px] text-[#929292]",children:F("internet",h)})]})]}),C(h)]})})]}),"denied"===x&&t.jsx("div",{className:"bg-[#FFF9E6] rounded-[10px] p-4 mb-6",children:t.jsx("p",{className:"text-[12px] text-[#8B7A00]",children:"💡 브라우저 설정에서 마이크 권한을 허용해주세요"})}),!j&&!S&&t.jsx(s,{onClick:()=>{f(!0),m("checking"),u("checking"),g(0),N&&N.getTracks().forEach(e=>e.stop()),E()},variant:"secondary",className:"w-full mb-3",children:"다시 확인"})]})}),t.jsx("div",{className:"px-6 pb-6 bg-white pt-4 border-t border-[#E7E7E7]",children:t.jsx(s,{onClick:()=>{"granted"===x&&"connected"===h&&(w("recording"),o("/level-test/recording"))},variant:"primary",className:"w-full",disabled:!S||j,children:j?"확인 중...":"계속하기"})})]})}export{o as default};
