import api from './index.js';

// ì˜¨ë³´ë”© ë°ì´í„° ì¡°íšŒ (Spring Boot API ì—°ë™)
export const getOnboardingData = async () => {
  try {
    const response = await api.get('/onboarding/data');
    return response.data;
  } catch (error) {
    console.error('Get onboarding data error:', error);
    throw error;
  }
};

// ì˜¨ë³´ë”© ì§„í–‰ ìƒíƒœ ì¡°íšŒ (Spring Boot API ì—°ë™)
export const getOnboardingProgress = async () => {
  try {
    const response = await api.get('/onboarding/progress');
    return response.data;
  } catch (error) {
    console.error('Get onboarding progress error:', error);
    throw error;
  }
};

// ì „ì²´ ì˜¨ë³´ë”© ì™„ë£Œ ì²˜ë¦¬ (Spring Boot API ì—°ë™)
export const completeAllOnboarding = async (onboardingData) => {
  try {
    const response = await api.post('/onboarding/complete', onboardingData);
    return response.data;
  } catch (error) {
    console.error('Complete all onboarding error:', error);
    throw error;
  }
};

// í˜„ìž¬ ì˜¨ë³´ë”© ë‹¨ê³„ ì¡°íšŒ (ìƒˆë¡œìš´ API)
export const getCurrentOnboardingStep = async () => {
  try {
    const response = await api.get('/onboarding/steps/current');
    return response.data;
  } catch (error) {
    console.error('Get current onboarding step error:', error);
    throw error;
  }
};

// ì˜¨ë³´ë”© ë‹¨ê³„ ê±´ë„ˆë›°ê¸°
export const skipOnboardingStep = async (stepNumber, reason = '') => {
  try {
    const response = await api.post(`/onboarding/steps/${stepNumber}/skip`, null, {
      params: { reason }
    });
    return response.data;
  } catch (error) {
    console.error(`Skip onboarding step ${stepNumber} error:`, error);
    throw error;
  }
};

// ë‹¨ê³„ë³„ ì˜¨ë³´ë”© ì €ìž¥ í•¨ìˆ˜ë“¤ (ìƒˆë¡œìš´ ì„œë²„ APIì— ë§žê²Œ ìˆ˜ì •)

// 1ë‹¨ê³„: ê°œì¸ì •ë³´ ì €ìž¥
export const saveOnboardingStep1 = async (personalData) => {
  try {
    // ì˜ì–´ ì´ë¦„ë§Œ ì €ìž¥í•˜ëŠ” API í˜¸ì¶œ
    const response = await api.post('/user/english-name', {
      englishName: personalData.englishName
    });
    return response.data;
  } catch (error) {
    console.error('Save onboarding step1 error:', error);
    throw error;
  }
};

// 2ë‹¨ê³„: í”„ë¡œí•„ ì •ë³´ ì €ìž¥
export const saveOnboardingStep2 = async (profileData) => {
  try {
    const response = await api.post('/onboarding/steps/2/save', profileData);
    return response.data;
  } catch (error) {
    console.error('Save onboarding step2 error:', error);
    throw error;
  }
};

// 3ë‹¨ê³„: í•™ìŠµ ì •ë³´ ì €ìž¥
export const saveOnboardingStep3 = async (learningData) => {
  try {
    const response = await api.post('/onboarding/steps/3/save', learningData);
    return response.data;
  } catch (error) {
    console.error('Save onboarding step3 error:', error);
    throw error;
  }
};

// 4ë‹¨ê³„: ì„ í˜¸ë„ ì €ìž¥
export const saveOnboardingStep4 = async (preferenceData) => {
  try {
    const response = await api.post('/onboarding/steps/4/save', preferenceData);
    return response.data;
  } catch (error) {
    console.error('Save onboarding step4 error:', error);
    throw error;
  }
};

// ì–¸ì–´ ì •ë³´ ì €ìž¥
export const saveLanguageInfo = async (languageData) => {
  try {
    console.log("ðŸ” saveLanguageInfo í˜¸ì¶œë¨, ìž…ë ¥ ë°ì´í„°:", languageData);
    console.log("ðŸ” nativeLanguageId:", languageData.nativeLanguageId);
    console.log("ðŸ” nativeLanguageId íƒ€ìž…:", typeof languageData.nativeLanguageId);
    
    const requestBody = {
      languageId: languageData.nativeLanguageId
    };
    console.log("ðŸ” API ìš”ì²­ ë³¸ë¬¸:", requestBody);
    
    const response = await api.post('/onboard/language/native-language', requestBody);
    
    // ëª©í‘œ ì–¸ì–´ë“¤ ì €ìž¥ (ë°°ì¹˜ë¡œ ì²˜ë¦¬)
    if (languageData.targetLanguages && languageData.targetLanguages.length > 0) {
      await api.post('/onboard/language/language-level', {
        languages: languageData.targetLanguages.map(targetLang => ({
          languageId: targetLang.languageId,
          currentLevelId: targetLang.currentLevelId,
          targetLevelId: targetLang.targetLevelId
        }))
      });
    }
    
    return response.data;
  } catch (error) {
    console.error('ðŸ” Save language info error:', error);
    console.error('ðŸ” Error response:', error.response);
    console.error('ðŸ” Error data:', error.response?.data);
    throw error;
  }
};

// ê´€ì‹¬ì‚¬ ì •ë³´ ì €ìž¥
export const saveInterestInfo = async (interestData) => {
  try {
    const requests = [];
    
    // ë™ê¸° ì €ìž¥ (ë°°ì¹˜ë¡œ ì²˜ë¦¬)
    if (interestData.motivationIds && interestData.motivationIds.length > 0) {
      requests.push(
        api.post('/onboard/interest/motivation', { 
          motivationIds: interestData.motivationIds 
        })
      );
    }
    
    // ì£¼ì œ ì €ìž¥ (ë°°ì¹˜ë¡œ ì²˜ë¦¬)
    if (interestData.topicIds && interestData.topicIds.length > 0) {
      requests.push(
        api.post('/onboard/interest/topic', { 
          topicIds: interestData.topicIds 
        })
      );
    }
    
    // í•™ìŠµ ìŠ¤íƒ€ì¼ ì €ìž¥ (ë°°ì¹˜ë¡œ ì²˜ë¦¬)
    if (interestData.learningStyleIds && interestData.learningStyleIds.length > 0) {
      requests.push(
        api.post('/onboard/interest/learning-style', { 
          learningStyleIds: interestData.learningStyleIds 
        })
      );
    }
    
    // í•™ìŠµ ê¸°ëŒ€ ì €ìž¥ (ë°°ì¹˜ë¡œ ì²˜ë¦¬)
    if (interestData.learningExpectationIds && interestData.learningExpectationIds.length > 0) {
      requests.push(
        api.post('/onboard/interest/learning-expectation', { 
          learningExpectationIds: interestData.learningExpectationIds 
        })
      );
    }
    
    await Promise.all(requests);
    return { success: true };
  } catch (error) {
    console.error('Save interest info error:', error);
    throw error;
  }
};

// íŒŒíŠ¸ë„ˆ ì„ í˜¸ë„ ì €ìž¥
export const savePartnerInfo = async (partnerData) => {
  try {
    const requests = [];
    
    // íŒŒíŠ¸ë„ˆ ì„±ê²© ì €ìž¥ (ë°°ì¹˜ë¡œ ì²˜ë¦¬)
    if (partnerData.partnerPersonalityIds && partnerData.partnerPersonalityIds.length > 0) {
      requests.push(
        api.post('/onboard/partner/personality', { 
          personalPartnerIds: partnerData.partnerPersonalityIds 
        })
      );
    }
    
    // ê·¸ë£¹ í¬ê¸°ëŠ” ìŠ¤ì¼€ì¤„ APIì—ì„œ ì²˜ë¦¬ë©ë‹ˆë‹¤
    
    await Promise.all(requests);
    return { success: true };
  } catch (error) {
    console.error('Save partner info error:', error);
    throw error;
  }
};

// ìŠ¤ì¼€ì¤„ ì •ë³´ ì €ìž¥
export const saveScheduleInfo = async (scheduleData) => {
  try {
    // ìŠ¤ì¼€ì¤„ ë°ì´í„°ê°€ ìžˆëŠ” ê²½ìš° ì„œë²„ë¡œ ì „ì†¡
    if (scheduleData.schedules && scheduleData.schedules.length > 0) {
      const response = await api.post('/onboard/schedule', { 
        schedules: scheduleData.schedules 
      });
      return response.data;
    }
    
    // ìŠ¤ì¼€ì¤„ì´ ì—†ëŠ” ê²½ìš°ì—ë„ ì„±ê³µìœ¼ë¡œ ì²˜ë¦¬ (ì‚¬ìš©ìžê°€ ìŠ¤ì¼€ì¤„ì„ ì„ íƒí•˜ì§€ ì•Šì„ ìˆ˜ ìžˆìŒ)
    return { success: true };
  } catch (error) {
    console.error('Save schedule info error:', error);
    throw error;
  }
};

// ì˜¨ë³´ë”© ì˜µì…˜ ì¡°íšŒ í•¨ìˆ˜ë“¤ (ê¸°ì¡´ API í™œìš©)

// ì–¸ì–´ ëª©ë¡ ì¡°íšŒ
export const getLanguages = async () => {
  try {
    const response = await api.get('/onboard/language/languages');
    return response.data;
  } catch (error) {
    console.error('Get languages error:', error);
    throw error;
  }
};

// ì–¸ì–´ ë ˆë²¨ íƒ€ìž… ì¡°íšŒ
export const getLanguageLevelTypes = async () => {
  try {
    const response = await api.get('/onboard/language/level-types-language');
    return response.data;
  } catch (error) {
    console.error('Get language level types error:', error);
    throw error;
  }
};

// íŒŒíŠ¸ë„ˆ ë ˆë²¨ íƒ€ìž… ì¡°íšŒ
export const getPartnerLevelTypes = async () => {
  try {
    const response = await api.get('/onboard/language/level-types-partner');
    return response.data;
  } catch (error) {
    console.error('Get partner level types error:', error);
    throw error;
  }
};

// ë™ê¸° ëª©ë¡ ì¡°íšŒ
export const getMotivations = async () => {
  try {
    const response = await api.get('/onboard/interest/motivations');
    return response.data;
  } catch (error) {
    console.error('Get motivations error:', error);
    throw error;
  }
};

// ì£¼ì œ ëª©ë¡ ì¡°íšŒ
export const getTopics = async () => {
  try {
    const response = await api.get('/onboard/interest/topics');
    return response.data;
  } catch (error) {
    console.error('Get topics error:', error);
    throw error;
  }
};

// í•™ìŠµ ìŠ¤íƒ€ì¼ ëª©ë¡ ì¡°íšŒ
export const getLearningStyles = async () => {
  try {
    const response = await api.get('/onboard/interest/learning-styles');
    return response.data;
  } catch (error) {
    console.error('Get learning styles error:', error);
    throw error;
  }
};

// í•™ìŠµ ê¸°ëŒ€ ëª©ë¡ ì¡°íšŒ
export const getLearningExpectations = async () => {
  try {
    const response = await api.get('/onboard/interest/learning-expectations');
    return response.data;
  } catch (error) {
    console.error('Get learning expectations error:', error);
    throw error;
  }
};